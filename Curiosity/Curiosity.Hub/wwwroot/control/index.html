<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>„É©„Ç∏„Ç≥„É≥Êìç‰ΩúÁîªÈù¢</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
        }

        .controller {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .title {
            text-align: center;
            font-size: 24px;
            margin-bottom: 30px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .controls-grid {
            display: grid;
            grid-template-columns: repeat(3, 80px);
            grid-template-rows: repeat(3, 80px);
            gap: 10px;
            margin-bottom: 30px;
        }

        .control-btn {
            background: linear-gradient(145deg, #4facfe 0%, #00f2fe 100%);
            border: none;
            border-radius: 15px;
            color: white;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
            user-select: none;
            position: relative;
            overflow: hidden;
        }

        .control-btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: all 0.3s ease;
        }

        .control-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 24px rgba(0, 0, 0, 0.3);
        }

        .control-btn:active {
            transform: translateY(0);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .control-btn:active::before {
            width: 120%;
            height: 120%;
        }

        .control-btn:disabled {
            background: #cccccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        /* „Ç∞„É™„ÉÉ„ÉâÈÖçÁΩÆ */
        .btn-forward-left {
            grid-area: 1 / 1 / 2 / 2;
        }

        .btn-forward {
            grid-area: 1 / 2 / 2 / 3;
        }

        .btn-forward-right {
            grid-area: 1 / 3 / 2 / 4;
        }

        .btn-left {
            grid-area: 2 / 1 / 3 / 2;
        }

        .btn-center {
            grid-area: 2 / 2 / 3 / 3;
            background: rgba(255, 255, 255, 0.2);
            cursor: default;
        }

        .btn-right {
            grid-area: 2 / 3 / 3 / 4;
        }

        .btn-backward-left {
            grid-area: 3 / 1 / 4 / 2;
        }

        .btn-backward {
            grid-area: 3 / 2 / 4 / 3;
        }

        .btn-backward-right {
            grid-area: 3 / 3 / 4 / 4;
        }

        .btn-center {
            background: linear-gradient(145deg, #ff6b6b 0%, #feca57 100%);
            font-size: 20px;
        }

        .status {
            text-align: center;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
        }

        .status-text {
            font-size: 18px;
            margin-bottom: 10px;
        }

        .connection-indicator {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
        }

        .indicator-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #00ff00;
            box-shadow: 0 0 10px rgba(0, 255, 0, 0.5);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.5;
            }
        }

        .speed-control {
            margin-top: 20px;
            text-align: center;
        }

        .speed-slider {
            width: 200px;
            height: 6px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 3px;
            outline: none;
            margin: 10px 0;
            cursor: pointer;
        }

        .speed-slider::-webkit-slider-thumb {
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: linear-gradient(145deg, #4facfe 0%, #00f2fe 100%);
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }

        @media (max-width: 480px) {
            .controller {
                padding: 20px;
                margin: 10px;
            }

            .controls-grid {
                grid-template-columns: repeat(3, 70px);
                grid-template-rows: repeat(3, 70px);
            }

            .control-btn {
                font-size: 14px;
            }
        }
    </style>
</head>

<body>
    <div class="controller">
        <h1 class="title">üöó „É©„Ç∏„Ç≥„É≥Êìç‰Ωú„Éë„Éç„É´</h1>

        <div class="controls-grid">
            <button class="control-btn btn-forward-left" data-direction="forward-left"
                onclick="connection.invoke('SetDirectionAsync', 40);">‚Üñ</button>
            <button class="control-btn btn-forward" data-direction="forward"
                onclick="connection.invoke('SetDirectionAsync', 170);">‚Üë</button>
            <button class="control-btn btn-forward-right" data-direction="forward-right"
                onclick="connection.invoke('SetDirectionAsync', 130);">‚Üó</button>

            <button class="control-btn btn-left" data-direction="left"
                onclick="connection.invoke('SetDirectionAsync', 105);">‚Üê</button>
            <button class="control-btn btn-center" onclick="connection.invoke('SetDirectionAsync', 0);">‚èπ</button>
            <button class="control-btn btn-right" data-direction="right"
                onclick="connection.invoke('SetDirectionAsync', 150);">‚Üí</button>

            <button class="control-btn btn-backward-left" data-direction="backward-left"
                onclick="connection.invoke('SetDirectionAsync', 65);">‚Üô</button>
            <button class="control-btn btn-backward" data-direction="backward"
                onclick="connection.invoke('SetDirectionAsync', 85);">‚Üì</button>
            <button class="control-btn btn-backward-right" data-direction="backward-right"
                onclick="connection.invoke('SetDirectionAsync', 20);">‚Üò</button>
        </div>

        <div class="status">
            <div class="status-text" id="status-text">ÂæÖÊ©ü‰∏≠</div>
            <div class="connection-indicator">
                <span class="indicator-dot"></span>
                <span>Êé•Á∂ö‰∏≠</span>
            </div>
        </div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/6.0.1/signalr.js"></script>
    <script type="text/javascript">
        const connection = new signalR.HubConnectionBuilder()
            .withUrl("https://rover-hub.taiseiue.jp/command")
            .configureLogging(signalR.LogLevel.Information)
            .build();

        async function start() {
            try {
                await connection.start();
                console.log("SignalR Connected.");
            } catch (err) {
                console.log(err);
                setTimeout(start, 5000);
            }
        };

        connection.onclose(async () => {
            await start();
        });

        // Start the connection.
        start();
    </script>
    <script>
        // Êìç‰ΩúÁä∂ÊÖã„ÅÆÁÆ°ÁêÜ
        let currentDirection = null;
        let currentSpeed = 5;

        // DOMË¶ÅÁ¥†„ÅÆÂèñÂæó
        const statusText = document.getElementById('status-text');
        const speedSlider = document.getElementById('speed');
        const speedValue = document.getElementById('speed-value');
        const controlButtons = document.querySelectorAll('.control-btn[data-direction]');

        // ÊñπÂêëÂêç„ÅÆÊó•Êú¨Ë™û„Éû„ÉÉ„Éî„É≥„Ç∞
        const directionNames = {
            'forward': 'ÂâçÈÄ≤',
            'backward': 'ÂæåÈÄÄ',
            'left': 'Â∑¶',
            'right': 'Âè≥',
            'forward-left': 'Â∑¶Ââç',
            'forward-right': 'Âè≥Ââç',
            'backward-left': 'Â∑¶Âæå„Çç',
            'backward-right': 'Âè≥Âæå„Çç'
        };

        // „Çπ„Éî„Éº„ÉâË™øÊï¥
        speedSlider.addEventListener('input', (e) => {
            speedValue.textContent = currentSpeed;
            if (currentDirection) {
                updateStatus(`${directionNames[currentDirection]}`);
            }
        });

        // „Éú„Çø„É≥„Ç§„Éô„É≥„Éà„ÅÆË®≠ÂÆö
        controlButtons.forEach(button => {
            const direction = button.dataset.direction;

            // „Éû„Ç¶„Çπ/„Çø„ÉÉ„ÉÅ„Ç§„Éô„É≥„Éà
            button.addEventListener('mousedown', () => startMovement(direction));
            button.addEventListener('mouseup', stopMovement);
            button.addEventListener('mouseleave', stopMovement);

            button.addEventListener('touchstart', (e) => {
                e.preventDefault();
                startMovement(direction);
            });
            button.addEventListener('touchend', (e) => {
                e.preventDefault();
                stopMovement();
            });

            // „Ç≠„Éº„Éú„Éº„Éâ„Çµ„Éù„Éº„Éà
            button.addEventListener('keydown', (e) => {
                if (e.code === 'Space' || e.code === 'Enter') {
                    e.preventDefault();
                    startMovement(direction);
                }
            });
            button.addEventListener('keyup', (e) => {
                if (e.code === 'Space' || e.code === 'Enter') {
                    e.preventDefault();
                    stopMovement();
                }
            });
        });

        // „Ç≠„Éº„Éú„Éº„ÉâÊìç‰Ωú
        document.addEventListener('keydown', (e) => {
            if (currentDirection) return; // Êó¢„Å´Âãï„ÅÑ„Å¶„ÅÑ„ÇãÂ†¥Âêà„ÅØ„Çπ„Ç≠„ÉÉ„Éó

            let direction = null;
            switch (e.code) {
                case 'ArrowUp':
                case 'KeyW':
                    direction = 'forward';
                    break;
                case 'ArrowDown':
                case 'KeyS':
                    direction = 'backward';
                    break;
                case 'ArrowLeft':
                case 'KeyA':
                    direction = 'left';
                    break;
                case 'ArrowRight':
                case 'KeyD':
                    direction = 'right';
                    break;
                case 'KeyQ':
                    direction = 'forward-left';
                    break;
                case 'KeyE':
                    direction = 'forward-right';
                    break;
                case 'KeyZ':
                    direction = 'backward-left';
                    break;
                case 'KeyC':
                    direction = 'backward-right';
                    break;
            }

            if (direction) {
                e.preventDefault();
                startMovement(direction);
                highlightButton(direction);
            }
        });

        document.addEventListener('keyup', (e) => {
            const keyCodes = ['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight', 'KeyW', 'KeyA', 'KeyS', 'KeyD', 'KeyQ', 'KeyE', 'KeyZ', 'KeyC'];
            if (keyCodes.includes(e.code)) {
                e.preventDefault();
                stopMovement();
                removeHighlight();
            }
        });

        // ÁßªÂãïÈñãÂßã
        function startMovement(direction) {
            if (currentDirection === direction) return;

            currentDirection = direction;
            updateStatus(`${directionNames[direction]} - ÈÄüÂ∫¶${currentSpeed}`);

            // „Åì„Åì„ÅßÂÆüÈöõ„ÅÆ„É©„Ç∏„Ç≥„É≥Âà∂Âæ°„ÅÆAPI„ÇíÂëº„Å≥Âá∫„Åô
            sendCommand(direction, currentSpeed);
        }

        // ÁßªÂãïÂÅúÊ≠¢
        function stopMovement() {
            if (!currentDirection) return;

            currentDirection = null;
            updateStatus('ÂæÖÊ©ü‰∏≠');

            // ÂÅúÊ≠¢„Ç≥„Éû„É≥„Éâ„ÅÆÈÄÅ‰ø°
            sendCommand('stop', 0);
        }

        // „Çπ„ÉÜ„Éº„Çø„ÇπÊõ¥Êñ∞
        function updateStatus(message) {
            statusText.textContent = message;
        }

        // „Éú„Çø„É≥„ÅÆ„Éè„Ç§„É©„Ç§„Éà
        function highlightButton(direction) {
            const button = document.querySelector(`[data-direction="${direction}"]`);
            if (button) {
                button.style.transform = 'translateY(0)';
                button.style.boxShadow = '0 4px 8px rgba(0, 0, 0, 0.2)';
            }
        }

        function removeHighlight() {
            controlButtons.forEach(button => {
                button.style.transform = '';
                button.style.boxShadow = '';
            });
        }

        // ÂàùÊúüÂåñ
        document.addEventListener('DOMContentLoaded', () => {
            updateStatus('ÂæÖÊ©ü‰∏≠');
            console.log('„É©„Ç∏„Ç≥„É≥Êìç‰Ωú„Éë„Éç„É´„ÅåÂàùÊúüÂåñ„Åï„Çå„Åæ„Åó„Åü');
            console.log('„Ç≠„Éº„Éú„Éº„ÉâÊìç‰Ωú: WASD, Áü¢Âç∞„Ç≠„Éº, Q(Â∑¶Ââç), E(Âè≥Ââç), Z(Â∑¶Âæå„Çç), C(Âè≥Âæå„Çç)');
        });

        // „Éö„Éº„Ç∏Èõ¢ËÑ±ÊôÇ„ÅÆÂÅúÊ≠¢Âá¶ÁêÜ
        window.addEventListener('beforeunload', () => {
            if (currentDirection) {
                connection.invoke('SendCommandAsync', 0);
            }
        });
    </script>
</body>

</html>